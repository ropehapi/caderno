<div class="formattedText" data-external-links="">
                                <p>Quando temos uma base de dados criada com backups automáticos habilitados, no menu "Ações", temos a opção de criar réplicas de leitura. Vamos começar entendendo o que é uma réplica de leitura.</p>
<p>Eu já comentei algumas vezes que esse é um curso específico de banco de dados na AWS. Réplica de leitura não é um conceito da AWS, e sim um conceito geral de banco de dados. Então a expectativa é que já conheçam esse termo, mas vou explicar para, caso não conheçam o conceito de réplica de leitura, essa aula faça sentido para você também.</p>
<p>Imaginem que temos um cenário onde recebemos bastantes requisições em uma aplicação web, por exemplo, e que estamos criando o banco de dados dessa aplicação. Muitas vezes teremos mais leitura do que escrita em um banco de dados, ou seja, é mais comum listarmos os usuários disponíveis, ou algum outro detalhe, do que inserir novos dados.</p>
<p>Reparem que quando estamos inserindo um dado, estamos utilizando recursos do mesmo banco de dados que poderíamos utilizar apenas para ler os dados, porque queremos apenas receber as informações. Ao criarmos uma réplica de leitura, o que estamos fazendo é ter um banco de dados principal, como chamamos, e uma réplica de leitura.</p>
<p>No banco de dados principal, recebemos a escrita, como uma nova linha ou registro, e criaremos uma réplica de leitura nessa aula. Quando inserimos uma informação no banco de dados principal, ela é automaticamente sincronizada na réplica de leitura. Então faremos toda leitura no segundo banco de dados, ou seja, na réplica.</p>
<p>Assim, inserimos dados em um banco e lemos os dados em outro banco. Dessa forma, conseguimos distribuir a carga da aplicação em duas instâncias diferentes. Com isso garantimos uma disponibilidade maior no sistema e uma resposta mais rápida no banco de dados. Essa é a ideia por trás da réplica de leitura.</p>
<p>A criação da réplica de leitura utilizando o RDS é bastante simples. Em um cenário <em>on premise</em>, onde configuraríamos no MySQL, por exemplo, é bastante complexo de configurar, porém no RDS é bem fácil.</p>
<p>Iremos selecionar a instância de banco de dados, no caso o "database-1" e, na parte superior da tabela, clicar em "Ações &gt; Criar réplica de leitura". Como falei, essa opção estará habilitada se a instância de banco de dados principal possuir os backups automáticos habilitados. Senão, não é possível criar uma réplica.</p>
<p>Quando clicamos em "Criar réplica de leitura", vamos para outra página, onde tem o formulário de criação da réplica. No primeiro campo definimos a origem da réplica, ou seja, de qual banco de dados virão as informações inseridas. Só temos um banco, e é o que selecionamos para criar a réplica.</p>
<p>O segundo campo é escrevermos o identificador da instância de banco de dados. Escreveremos apenas "read-replica". Em seguida, temos a seção "Configuração da instância".</p>
<p>Reparem que é como se estivéssemos criando uma nova instância, ou seja, uma nova máquina. O ideal é que seja semelhante à máquina principal. Como estamos usando <em>free tier</em>, manteremos a "db.t3.micro".</p>
<p>Em seguida temos a seção "Região da AWS". Essa parte é bem interessante, porque podemos escolher uma nova região para réplica de leitura. Podemos ter a instância principal nos Estados Unidos e ter uma réplica de leitura no Brasil, no caso, "South America (São Paulo)", garantindo uma latência menor.</p>
<p>Isso aumenta um pouco a complexidade e a criação desse banco vai demorar. Reparem, inclusive, que essa página fica carregando, então vamos esperar terminar de carregar.</p>
<p>Ainda assim, em um cenário real de produção, essa é uma opção bastante interessante, porque, como eu disse, conseguimos diminuir a latência da réplica de leitura. Então as pessoas usuárias que acessarem o banco de dados irão ler os dados de uma instância mais próxima.</p>
<p>Claro que precisamos considerar que, se estamos criando uma aplicação web, quem acessará a instância do banco de dados é nossa máquina virtual, como o EC2 ou o Container que está rodando no ECS. O ideal é que a máquina de banco de dados esteja mais perto não da pessoa usuária final, mas de que irá acessá-la.</p>
<p>Idealmente, toda a estrutura deveria estar na pessoa usuária final, mas voltaremos a Região da AWS para "US East (N. Virgínia)" para mantermos tudo na mesma região. Assim evitamos criar vários bancos em regiões diferentes e nos perdermos na hora de apagar.</p>
<p>Essa atualização demora um pouco porque ele obtém todas as configurações da região escolhida. Quando carrega, podemos continuar configurando a réplica de leitura.</p>
<p>No caso, manteremos as demais configurações como padrão. Inclusive tem um detalhe na seção "Disponibilidade e durabilidade" que ainda não aplicamos, que é a "Implantação Multi-AZ". Eu expliquei rapidamente o que é, mas ainda não utilizamos, então fica um spoiler para próxima aula.</p>
<p>Portanto, todos os detalhes que configuramos na instância principal, podemos configurar na réplica de leitura também, porém manteremos tudo padrão. Ao final do formulário, no canto inferior direito, clicaremos no botão laranja "Criar réplica de leitura".</p>
<p>Fazendo isso, voltamos para página dos bancos de dados e agora temos duas instâncias diferentes: database-1 e read-replica. Inclusive podemos monitorá-las de forma independente.</p>
<p>Nossa réplica levará um tempo para ser criada, e estamos fazendo uma alteração no "database-1", que é a instância principal, para ela poder ser sincronizada com a réplica. Um detalhe que quase esqueci de citar: a criação de uma réplica de leitura consome recursos da base principal.</p>
<p>Sendo assim, tomem cuidado de não realizar a criação de uma réplica de leitura em um momento de pico da aplicação, e sim em um momento de baixo acessos. Do contrário, vocês irão consumir recursos do seu banco de dados, deixando menos recursos para responder as queries, degradando a performance naquele momento, o que pode ser perigoso.</p>
<p>Enquanto ele está modificando, vou pausar o vídeo. Volto em breve, mostrando que temos realmente duas instâncias com <em>endpoints</em> separados e com monitoramento separado.</p>
<p>Então, após bastante tempo, a réplica foi criada. Não é um processo rápido, portanto, após começá-lo, pode sair para beber uma água ou um café. Quando o processo finaliza, temos as duas instâncias de banco de dados.</p>
<p>Essas instâncias têm funções diferentes: a principal e a réplica. Na réplica não podemos realizar alterações de esquema ou inserir dados, ela é realmente uma réplica de leitura, e é importante termos isso em mente.</p>
<p>Como comentei, são duas instâncias independentes e, sendo assim, podemos monitorá-las e acessá-las de forma independente. Então, ao clicarmos no "database-1", passamos para outra página.</p>
<p>Nessa página, abaixo da tabela "Tópicos relacionados", temos os dados de "Segurança e conexão", incluindo o <em>endpoint</em>, que é o <em>host</em> com o qual acessaremos o MySQL. Subindo para tabela e clicando em "read-replica", notamos que nos dados de "Segurança e conexão" tem outro endpoint.</p>
<p>Então o usuário e a senha continuam os mesmos, apesar de eu não me lembrar deles e nem ter anotado, então não poderei acessar esse banco. Apesar disso, a ideia é que são dois bancos idênticos e o que realizarmos no "database-1", que é o principal, será replicado para a "read-replica".</p>
<p>Ainda assim, acessamos aos bancos de forma diferente, e na sua aplicação você precisará lidar com isso. Se é um local da aplicação que precisa inserir dados, precisaremos usar a conexão escrita, e se precisa ler os dados, será a conexão de leitura.</p>
<p>Essa é a ideia da réplica de leitura. Reparem que na AWS é bastante simples de criá-la. Precisamos nos atentar a alguns detalhes, mas nada muito complicado.</p>
<p>Um último detalhe que quero mostrar para vocês sobre a réplica de leitura é que podemos promovê-la. Imaginem que nossa instância principal saiu do ar e não está mais disponível, ou que, por outro motivo, queiramos tornar a réplica de leitura na instância principal.</p>
<p>Para isso, selecionaríamos a réplica de leitura, no caso, a "read-replica", e clicaríamos em "Ações &gt; Promover". Isso transformaria a réplica de leitura em outra instância principal, finalizando a conexão entre ela e o "database-1".</p>
<p><em>Em que cenários podemos fazer isso?</em> Se ao invés de fazer uma réplica de leitura, queremos passar a fazer <em>charging</em> de banco de dados, tendo partes da tabela em um banco e outra em outro bando. Nesse cenário, podemos promover a réplica.</p>
<p>Outra possibilidade de promoção da réplica é quando queremos evoluir o banco de dados de forma independente. Se queremos realizar alterações somente na réplica de leitura, também podemos promover, entre outras opções.</p>
<p>Então existem alguns motivos para promover a réplica de leitura a uma instância principal. Dessa forma, teremos duas instâncias independentes.</p>
<p>Já falei bastante sobre réplica de leitura, que é um assunto bastante interessante. Vale a pena estudar e se aprofundar mais nesse tema, mas eu falei que ia explicar sobre o "Multi-AZ". Então vamos conversar as <strong>múltiplas zonas de disponibilidade</strong> e <strong>alta disponibilidade</strong> com o RDS no próximo vídeo.</p>
                        </div>