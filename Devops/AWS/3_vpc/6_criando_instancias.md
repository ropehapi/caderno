<div class="formattedText" data-external-links="">
                                <p>Agora vamos criar duas instâncias, uma em cada sub-rede. Como já estudamos isso nos cursos anteriores, vou fazer mais rapidamente.</p>
<p>Vamos acessar o painel da EC2 e clicar em "Instâncias". Na verdade, vou permitir o uso da <code>primeira-maquina</code> e vou criar só mais uma.</p>
<p>A instância <code>primeira-maquina</code> está na zona de disponibilidade us-east-2a. Então vamos criar uma nova instância na zona de disponibilidade us-east-2b, ou seja, em outra sub-rede.</p>
<p>Vamos clicar em "Executar instâncias" e começar a preencher os campos para criação de uma nova instância. O nome dela será <code>segunda-maquina</code>, a imagem será a da Amazon Linux mesmo, tipo de instância será t.2.micro, par de chaves será aws-ohio.</p>
<p>No campo de configurações de rede, clicaremos em "Editar" e informaremos que vamos adicioná-lo na sub-rede B, us-east-2b. Vamos selecionar a opção que tem a zona de disponibilidade: us-east-2b.</p>
<p>Vamos manter a opção "Criar grupo de segurança". E como não queremos adicionar nenhuma regra nesse grupo, na seção "Regras do grupo de segurança de entrada" vamos clicar em "Remover". Então nomearemos esse grupo como "grupo-vazio". Só para criar um novo grupo de segurança específico para essa máquina caso seja preciso ter algo específico. Mas, por enquanto, vamos deixar vazio.</p>
<p>Em seguida, podemos clicar em "Executar instância".</p>
<p>Agora, voltaremos para a lista de instâncias e vamos tentar acessar a <code>primeira-maquina</code>. Sabemos que não será possível, mas vou tentar mesmo assim para ver o que acontece.</p>
<p>Após selecionar a instância <code>primeira-maquina</code>, clicaremos em "Ações &gt; Conectar". Na aba "Cliente SSH" vamos copiar o comando que precisamos:</p>
<pre class="prettyprint"><code class="hljs language-sql">ssh <span class="hljs-operator">-</span>i "aws-ohio.pem" ec2<span class="hljs-operator">-</span><span class="hljs-keyword">user</span><span class="hljs-variable">@ec2</span><span class="hljs-number">-13</span><span class="hljs-number">-58</span><span class="hljs-number">-7</span><span class="hljs-number">-162.</span>us<span class="hljs-operator">-</span>east<span class="hljs-number">-2</span>compute.amazonaws.com</code><button type="button" class="clipit">Copiar código</button></pre><p>Em seguida, abriremos o terminal. E, na pasta <code>.ssh</code> já temos a chave <code>aws-ohio-pem</code> que colocamos com a permissão 400, para ela estar com as permissões corretas.</p>
<p>Podemos colar aquele comando que copiamos da aba "Cliente SSH" e ao tentarmos nos conectar, não vamos conseguir.</p>
<p>Isso acontece porque ainda não temos o grupo de segurança que permite acesso SSH.</p>
<p>Para corrigir isso, vamos voltar para a instância <code>primeira-maquina</code> e clicar em "Ações &gt; Segurança &gt; Alterar grupos de segurança". Na seção de grupos de segurança associados, podemos adicionar o grupo de segurança SSH. </p>
<p>Agora, vamos voltar ao terminal, cancelar o comando anterior e executar novamente o mesmo comando. </p>
<pre class="prettyprint"><code class="hljs language-sql">ssh <span class="hljs-operator">-</span>i "aws-ohio.pem" ec2<span class="hljs-operator">-</span><span class="hljs-keyword">user</span><span class="hljs-variable">@ec2</span><span class="hljs-number">-13</span><span class="hljs-number">-58</span><span class="hljs-number">-7</span><span class="hljs-number">-162.</span>us<span class="hljs-operator">-</span>east<span class="hljs-number">-2</span>compute.amazonaws.com</code><button type="button" class="clipit">Copiar código</button></pre><p>Agora, sim. Conseguimos a conexão.</p>
<p>Já podemos pegar o IP da segunda máquina.</p>
<p>Voltaremos para a lista de instâncias, vamos selecionar a instância <code>segunda-maquina</code> e localizar o endereço IPv4 privado.</p>
<pre class="prettyprint"><code class="hljs language-undefined">172.31.28.109</code><button type="button" class="clipit">Copiar código</button></pre><p>Vamos copiar e voltar ao terminal para tentar fazer um PING para essa instância.</p>
<pre class="prettyprint"><code class="hljs language-undefined">ping 172.31.28.109</code><button type="button" class="clipit">Copiar código</button></pre><p>Note que o PING foi enviado, mas não estou conseguindo acessar aquela máquina ou receber a resposta. Você já deve saber o motivo. Não tem nenhum grupo de segurança lá, não consigo fazer o acesso.</p>
<p>Então, vamos cancelar esse comando no terminal e voltar para o console AWS.</p>
<p>Na instância <code>segunda-maquina</code>, clicaremos em "Ações &gt; Segurança &gt; Alterar grupos de segurança". Vamos adicionar o grupo de segurança padrão, o <em>default</em>, na seção de grupos de segurança associados.</p>
<p>Com isso, todos que estiverem no grupo de segurança default (sg-082714481a7d8045b) conseguirão fazer todos os acessos.</p>
<p>Podemos salvar essa alteração.</p>
<p>Se analisarmos as regras desse grupo de segurança <em>default</em>, ele permite o acesso liberado em qualquer porta e utilizando qualquer protocolo desde que seja vindo de uma origem que está nesse grupo de segurança também.</p>
<p>Agora, que as duas instâncias estão no mesmo grupo de segurança, podemos tentar fazer o PING.</p>
<pre class="prettyprint"><code class="hljs language-undefined">ping 172.31.28.109</code><button type="button" class="clipit">Copiar código</button></pre><p>Agora funcionou corretamente. Mesmo estando em sub-redes diferentes, eles estão acessíveis.</p>
<p>Mas eu já disse que existe uma outra ferramenta que nos permite uma maior granularidade de informações na nossa rede.</p>
<p>Então, utilizando essa outra ferramenta, quero permitir acesso à minha segunda instância somente a partir da primeira instância.</p>
<p>Vamos limpar a tela e sair da instância.</p>
<pre class="prettyprint"><code class="hljs language-bash"><span class="hljs-built_in">exit</span></code><button type="button" class="clipit">Copiar código</button></pre><p>De volta à AWS, vamos alterar grupos de segurança da <code>segunda-maquina</code> e adicionar o SSH no "grupos de segurança associados" e clicar em "Adicionar grupo de segurança". Ou seja, permito acesso SSH à minha máquina.</p>
<p>Em seguida, nos detalhes da <code>segunda-maquina</code>, vamos clicar em "Ações &gt; Conectar" e copiar o comando do exemplo:</p>
<pre class="prettyprint"><code class="hljs language-sql">ssh <span class="hljs-operator">-</span>i "aws-ohio.pem" ec2<span class="hljs-operator">-</span><span class="hljs-keyword">user</span><span class="hljs-variable">@ec2</span><span class="hljs-number">-13</span><span class="hljs-number">-58</span><span class="hljs-number">-82</span><span class="hljs-number">-28.</span>us<span class="hljs-operator">-</span>east<span class="hljs-number">-2</span>compute.amazonaws.com</code><button type="button" class="clipit">Copiar código</button></pre><p>Podemos colar esse comando no terminal e ver se conseguimos conexão com essa instância.</p>
<p>Conseguimos conexão.</p>
<p>O que estamos fazendo aqui? Temos acesso via SSH tanto à primeira instância quanto à segunda instância. Agora, na segunda instância, quero permitir acesso somente a partir da primeira instância. Ou seja, bloquear todo acesso a ela e liberar somente acesso vindo da primeira instância.</p>
<p>Então teremos regras como fazemos no firewall mesmo. Pegando o IP e bloqueando ou permitindo o IP. Vamos fazer isso com um serviço chamado <strong>ACL</strong>.</p>
                        </div>