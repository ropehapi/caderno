<div class="formattedText" data-external-links="">
                                <p>Criamos o nosso <em>bucket</em>, configuramos as permissões e portanto somos capazes de acessar um <em>bucket</em> S3 a partir da nossa instância. Mas isso não tem nada a ver com VPC! Não precisamos configurar nada relacionado a VPC para que o acesso funcione.</p>
<p>Agora, veremos a parte de redes. Mesmo que a nossa rede VPC e o S3 estejam na AWS e na mesma região, quando fazemos o acesso, passamos pela internet, resolvemos o nome, damos vários saltos na rede e só depois retornamos à AWS.</p>
<p>Para ver esse processo acontecendo, usaremos o comando <code>tcptraceroute</code>, junto ao <code>sudo</code>, o endereço <code>s3.us-east-2.amazonaws.com</code> que queremos seguir e a porta que queremos acessar.</p>
<p>Neste caso, a porta será <code>80</code> que corresponde ao HTTP, mas poderíamos utilizar a porta <code>443</code>, que é a HTTPS.</p>
<pre class="prettyprint"><code class="hljs language-undefined">sudo tcptraceroute s3.us-east-2.amazonaws.com 80</code><button type="button" class="clipit">Copiar código</button></pre><p>Vamos digitá-lo no terminal e pressionar "Enter". Este comando possui vários passos e pode demorar a ser executado.</p>
<p>Após a sua execução, veremos que ele deu vários saltos por endereços públicos, chegando por fim ao nosso endereço S3 <code>52.219.110.49</code>. Com isso perdemos tempo e recursos.</p>
<p>Queremos informar que <strong>existe um caminho direto</strong> a partir da nossa sub-rede até o S3. Faremos isso através de <strong>Endpoints</strong> que ligam um ponto à outro na nossa sub-rede.</p>
<p>Voltaremos à página da AWS, por onde acessaremos nossa configuração de VPC, clicando no submenu "Suas VPCs" por meio do explorador. Ainda no explorador, no painel da VPC, clicaremos em "Endpoints".</p>
<p>A página "Endpoints" será aberta, onde veremos que não existe nenhum. Vamos criá-lo clicando no botão "Criar endpoint", localizado à direita do título da página.</p>
<p>Neste caso, um <em>endpoint</em> ou VPC <em>endpoint</em> é uma ligação entre nossa sub-rede e um serviço da <em>Amazon</em>.</p>
<p>Na página de criação, acessaremos o campo intitulado "Etiqueta de nome", dentro do qual digitaremos o nome <code>direct-s3</code>. O nome não precisa ser esse, sinta-se livre para escolher um nome melhor!</p>
<p>Estamos nos conectando a um serviço da Amazon, portanto, na seção "Categoria de serviço", selecionaremos "Serviços da AWS".</p>
<p>Já na seção "Serviços", filtraremos o serviço que queremos — no caso, digitaremos "s3" no campo de busca e selecionaremos a opção "com.amazonaws.us-east-2.s3" na lista de resultados.</p>
<p>Serão exibidas três opções. Entre elas, não abordaremos a "com.amazonaws.us-east-2.s3-outposts". As outras duas opções são denominadas "com.amazonaws.us-east-2.s3", onde uma possui o tipo interface e outra o tipo <em>gateway</em>.</p>
<p>O tipo dita a forma como nos conectaremos: com o <em>gateway</em>, temos uma espécie de VPN direto para o S3. Já com a interface, a própria Amazon cria e conecta essas duas interfaces de rede <em>de forma virtual</em>. A diferença entre elas é sutil.</p>
<p>Utilizamos esse tipo em serviços como o S3 e <em>DynamoDB</em>. Em todos os outros, nós utilizamos o tipo interface. Na própria documentação da Amazon temos essa recomendação.</p>
<p>No nosso caso estamos utilizando o S3, e portanto selecionaremos o tipo <em>gateway</em>. Neste momento, será aberta a seção "VPC" onde selecionaremos em qual VPC criaremos esse <em>endpoint</em>. Vamos selecionar a nossa infra-vpc: "vpc-0615fc55438a59826 (infra-vpc)".</p>
<p>O <em>endpoint</em> do tipo <em>gateway</em> precisa ser adicionado nas nossas tabelas de rotas. Na seção "Tabela de rotas", podemos adicionar em uma ou mais tabelas. Neste caso, adicionaremos nas três redes que temos: a principal, a pública e a privada. Dessa forma, se criarmos uma nova sub-rede já teremos este <em>endpoint</em> adicionado em todos os locais.</p>
<p>Por enquanto utilizaremos o <em>endpoint</em> somente na rede pública para vermos a rota acontecendo.</p>
<p>Na seção "Política", podemos limitar o acesso, proibindo que o acesso a esse <em>endpoint</em> fosse feito através de determinada rede, por exemplo. No nosso caso, liberaremos o acesso irrestrito, selecionando a opção "Acesso total".</p>
<p>A sessão "Tags" terá a chave "Name" com o valor "direct-s3" preenchida. Vamos deixar como está. Por fim, clicaremos no botão "Criar endpoint", no fim da página, alinhado à direita.</p>
<p>Teoricamente, é só isso que precisamos. Seremos redirecionados para a página "Endpoints", onde veremos o <em>endpoint</em> que criamos. Na coluna "Status", veremos o valor "Disponível". Isso leva um tempo para ser refletido na rede, portanto vamos aguardar alguns minutos antes de executar o <code>tcptraceroute</code> novamente.</p>
<p>Enquanto isso, conferiremos a nossa tabela de rotas para garantir que temos uma rota definida na tabela de rotas da rede pública, por exemplo, para acessarmos o <em>endpoint</em> em vez do S3 utilizando o ID que acabamos de criar.</p>
<p>Por meio do explorador, abriremos o submenu "Tabelas de rotas", no qual buscaremos a tabela de rotas da sub-rede  pública <code>infra-rtb-public</code>. Clicaremos em seu ID, e na seção "Rotas" veremos as nossas rotas, entre as quais identificaremos uma rota com um destino esquisito: <code>pl-7ba54012</code>, o qual entenderemos posteriormente.</p>
<p>O alvo dele será o <em>endpoint</em> que acabamos de criar. Se clicarmos neste destino esquisito, veremos que ele é uma lista de prefixos — o <code>pl</code> significa "<em>prefix list</em>". Se selecionarmos essa lista, serão exibidos todos os seus prefixos, todas as entradas de intervalos de IP que fazem parte dela.</p>
<p>Quando tentarmos acessar qualquer um desses endereços, cairemos na regra de roteamento e iremos para o <em>endpoint</em>.</p>
<p>Voltando ao terminal, veremos que fomos desconectados. Vamos rodar o comando de conexão para voltar à máquina.</p>
<pre class="prettyprint"><code class="hljs language-sql">ssh <span class="hljs-operator">-</span>i "aws-ohio-pem" ec2<span class="hljs-operator">-</span><span class="hljs-keyword">user</span><span class="hljs-variable">@ec2</span><span class="hljs-number">-18</span><span class="hljs-number">-224</span><span class="hljs-number">-179</span><span class="hljs-number">-96.</span>us<span class="hljs-operator">-</span>east<span class="hljs-number">-2.</span>compute.amazonaws.com</code><button type="button" class="clipit">Copiar código</button></pre><p>Em seguida, executaremos novamente o <code>tcptraceroute</code> para </p>
<pre class="prettyprint"><code class="hljs language-undefined">sudo tcptraceroute s3.us-east-2.amazonaws.com 80</code><button type="button" class="clipit">Copiar código</button></pre><p>Vamos aguardar a sua execução, enquanto observamos que nenhum salto foi feito, exceto aquele que direciona diretamente para o S3. Dessa forma, realizamos uma ligação direta entre a nossa VPC e o S3, sem precisar acessar a internet. </p>
<p>Este processo poupa recursos e otimiza a nossa performance, além de economizar dinheiro nos casos em que precisamos utilizar <em>NAT Gateways</em> ou outros serviços pagos.</p>
<p>Entendemos como trabalhar com sub-redes e entendemos as tabelas de rotas. A seguir, abordaremos o <strong><em>controle da nossa VPC</em></strong>. Vamos adquirir mais controle sobre como e quem acessa a nossa rede. </p>
<p>Já estamos utilizando uma técnica de controle, a qual entenderemos melhor. Não se trata de uma tecnologia da AWS, mas é interessante conhecê-la e entender como estamos realizando esta tarefa.</p>
                        </div>