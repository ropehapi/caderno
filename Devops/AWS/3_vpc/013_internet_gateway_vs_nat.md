<div class="formattedText" data-external-links="">
                                <p>Configuraremos redes dentro da AWS graças ao <strong>VPC</strong>, o serviço de <em>Virtual Private Cloud</em> (ou Nuvem Privada Virtual). </p>
<p>Vamos entender um detalhe que impacta a criação da nossa VPC: quando a criamos, temos uma sub-rede pública e uma privada. A principal diferença entre elas são as conexões de rede.</p>
<p>Para a rede pública, é realizada a conexão entre a sub-rede e um <strong><em>Internet Gateway</em></strong>, que consiste em um portão que se abre para acessarmos a sub-rede a partir da internet. Com isso, temos uma ligação do mundo externo com a nossa sub-rede. Para realizar essa operação, precisaremos de um IP público, contudo podemos utilizar a Amazon em seu lugar.</p>
<p>Por este motivo, <strong><em>não conseguimos acessar nossa sub-rede privada de fora da internet</em></strong>. Vamos colocar este fato à prova.</p>
<p>Acessaremos a AWS. No campo de pesquisa intitulado "<em>Search</em>" da barra superior digitaremos "EC2". Serão exibidos uma lista de menus à esquerda com o menu "<em>Services</em>" selecionado, e à direita uma lista com quatro opções clicáveis, disponíveis dentro do "Services".</p>
<p>Dentre as quatro opções, selecionaremos "EC2", abrindo-a em outra aba. O painel do EC2 será aberto, onde acessaremos o explorador lateral esquerdo e buscaremos o menu "Rede e segurança". Dentro dele, selecionaremos a opção "IPs elásticos".</p>
<p>No corpo da página, selecionaremos o botão "Alocar endereço IP elástico", localizado abaixo da barra de ferramentas superior.</p>
<p>Seremos direcionados para uma nova página, onde alocaremos o IP elástico. Manteremos todas as opções como padrão e clicaremos no botão "Alocar". Isso criará um novo IP público e nos redirecionará para a página anterior.</p>
<p>Nela, acessaremos a lista no centro da página e selecionaremos o <em>checkbox</em> que corresponde ao nosso endereço IP. Em seguida acessaremos o botão de lista suspensa "Ações", no qual selecionaremos "Associar endereço IP elástico".</p>
<p>Seremos direcionados para uma nova página, onde manteremos a opção "Instância" selecionada. Na campo editável de busca que possui o título "Instância", selecionaremos o ID da nossa <code>maquina-bd</code> que se encontra em uma sub-rede privada: </p>
<blockquote>
<p>i-0320e2c836d0bd4ae (maquina-bd) - running</p>
</blockquote>
<p>Clicaremos no botão "Associar". Com isso, vamos atribuir um IP público à nossa instância que está dentro de uma rede privada. Seremos redirecionados à página anterior, cujo topo exibirá um pop-up na cor verde com a mensagem "Endereço IP elástico associado com êxito."</p>
<p>No explorador lateral esquerdo, dentro do menu "Instâncias", selecionaremos a opção "Instâncias". Uma nova tela será aberta no corpo da página. Nela, iremos até a coluna "ID da instância", dentro da qual selecionaremos o ID da nossa <code>maquina-bd</code>.</p>
<p>Na nova página aberta, veremos uma seção denominada "Endereço IPv4 público", onde temos nosso endereço IPv4 marcado. Acima desta seção, à esquerda, clicaremos no botão "Conectar".</p>
<p>Seremos direcionados para uma nova página, onde acessaremos o menu "Cliente SSH". Em seu interior, veremos a nossa DNS.</p>
<blockquote>
<p>chmod 400 aws-ohio.pem</p>
</blockquote>
<p>Abaixo dela, temos o comando de conexão abaixo, o qual iremos copiar.</p>
<pre class="prettyprint"><code class="hljs language-sql">ssh <span class="hljs-operator">-</span>i "aws-ohio.pem" ec2<span class="hljs-operator">-</span><span class="hljs-keyword">user</span><span class="hljs-variable">@ec1</span><span class="hljs-number">-3</span><span class="hljs-number">-14</span><span class="hljs-number">-95</span><span class="hljs-number">-226.</span>us<span class="hljs-operator">-</span>east<span class="hljs-number">-2.</span>compute.amazonaws.com</code><button type="button" class="clipit">Copiar código</button></pre><p>Acessaremos o nosso terminal, onde colaremos o comando copiado e pressionaremos "Enter". Neste momento, tentaremos nos conectar mas nada acontece. Você deve estar pensando "Vinicius, você não atribuiu o grupo de segurança!" Verdade, portanto interromperemos o comando no terminal com "Ctrl+C".</p>
<p>Voltaremos à página do EC2. No topo, há o caminho de menus que seguimos para chegar na página atual: "EC2 &gt; Instâncias &gt; i-0320e2c836d0bd4ae &gt; Conectar-se à instância". Vamos clicar em "i-0320e2c836d0bd4ae" para voltar à página com as configurações da instância.</p>
<p>Nela, selecionaremos o botão de lista suspensa "Ações", no qual selecionaremos "Segurança &gt; Alterar grupos de segurança". Seremos direcionados a página da seção "Grupos de segurança associados". Nela, acessaremos o campo de busca denominado "Selecionar grupos de segurança", onde digitaremos o SSH público para atribuí-lo.</p>
<pre class="prettyprint"><code class="hljs language-undefined">sg-091fd5538fbf6022a</code><button type="button" class="clipit">Copiar código</button></pre><p>É possível encontrá-lo digitando "ss" e selecionando a opção "ssh-publico ( sg-091fd5538fbf6022a )" na lista suspensa que será aberta abaixo do campo.</p>
<p>Este grupo de segurança permite o acesso de todo mundo através de SSH. Agora que o atribuímos, voltaremos para o terminal para executar aquele mesmo comando de conexão.</p>
<p>Ainda não conseguimos conectar a esta instância a partir da nossa rede pessoal, mesmo ela tendo um IP público. Isso ocorre pois ela se encontra em uma <strong><em>rede privada</em></strong>. A diferença entre sub-redes privadas e públicas é que esta última possui uma configuração de rotas vinda de um <em>Internet Gateway</em>.</p>
<p>Por meio do terminal, acessaremos nossa instância a partir da nossa máquina web, adicionando novamente a chave e pressionando "Enter".</p>
<pre class="prettyprint"><code class="hljs language-bash">ssh-add ./aws-ohio.pem</code><button type="button" class="clipit">Copiar código</button></pre><p>Voltando à página do EC2, faremos um SSH para a nossa máquina web. Para isso, acessaremos o caminho de menus no topo da página: "EC2 &gt; Instâncias &gt; i-0320e2c836d0bd4ae", onde clicaremos em "Instâncias" para retornar à página de instâncias. Na coluna "ID de instância", clicaremos no ID da <code>maquina-web</code>. </p>
<p>No topo da nova página, clicaremos em "Conectar" e iremos para outra página. Nela, copiaremos o comando de conexão.</p>
<pre class="prettyprint"><code class="hljs language-sql">ssh <span class="hljs-operator">-</span>i "aws-ohio.pem" ec2<span class="hljs-operator">-</span><span class="hljs-keyword">user</span><span class="hljs-variable">@ec2</span><span class="hljs-number">-18</span><span class="hljs-number">-224</span><span class="hljs-number">-179</span><span class="hljs-number">-96.</span>us<span class="hljs-operator">-</span>east<span class="hljs-number">-2.</span>compute.amazonaws.com</code><button type="button" class="clipit">Copiar código</button></pre><p>Voltaremos ao terminal e colaremos este comando. Entre <code>ssh</code> e <code>-i</code> adicionaremos um <code>-A</code> com A maiúsculo. Deletaremos também a chave <code>-i "aws-ohio.pem"</code> pois ela já foi adicionada no nosso <code>ssh</code>.</p>
<pre class="prettyprint"><code class="hljs language-css">ssh -<span class="hljs-selector-tag">A</span> ec2-user<span class="hljs-keyword">@ec2-18-224-179-96</span>.us-east-2.compute.amazonaws.com</code><button type="button" class="clipit">Copiar código</button></pre><p>Por fim, daremos “Enter” e nos conectaremos à máquina web.</p>
<blockquote>
<p><a href="https://aws.amazon.com/amazon-linux-2/%5Bec2-user@ip-10-0-12-136" rel="nofollow noopener" target="_blank">https://aws.amazon.com/amazon-linux-2/[ec2-user@ip-10-0-12-136</a> ~]$</p>
</blockquote>
<p>A partir dela, nos conectaremos à máquina de banco de dados.</p>
<p>Voltando à página da EC2, na seção "Instâncias", clicaremos no ID da <code>maquina-bd</code> e na página "Resumo da instância para i-0320e2c836d0bd4ae" veremos à direita a subseção "Endereços IPv4 privados". Nela copiaremos o IP privado da máquina web:</p>
<pre class="prettyprint"><code class="hljs language-undefined">10.0.130.4</code><button type="button" class="clipit">Copiar código</button></pre><p>Voltaremos ao terminal e digitaremos <code>ssh ec2-user@</code> seguido pelo ID copiado. O resultado será o comando abaixo.</p>
<pre class="prettyprint"><code class="hljs language-sql">ssh ec2<span class="hljs-operator">-</span><span class="hljs-keyword">user</span><span class="hljs-variable">@10</span><span class="hljs-number">.0</span><span class="hljs-number">.130</span><span class="hljs-number">.4</span></code><button type="button" class="clipit">Copiar código</button></pre><p>Daremos "Enter" e faremos o SSH para a máquina web, que será concluído com sucesso. Se tentarmos executar um <code>sudo yum update</code>, ele tentará carregar as configurações de internet, mas não conseguirá acessar a internet propriamente dita, pois não possui o <em>Internet Gateway</em>.</p>
<pre class="prettyprint"><code class="hljs language-sql">sudo yum <span class="hljs-keyword">update</span></code><button type="button" class="clipit">Copiar código</button></pre><p>Se adicionarmos o <em>Internet Gateway</em> na nossa sub-rede privada, <strong><em>ela não será mais privada</em></strong>, já que estamos permitindo a entrada de dados. É aí que entra o <strong><em>NAT</em></strong>.</p>
<h3>Resumindo</h3>
<p>Se configuramos a rota de um <em>Internet Gateway</em> com a nossa sub-rede, ela se torna pública. Se precisamos que nossa sub-rede privada tenha acesso à internet, utilizamos o <strong><em>NAT Gateway</em></strong>, do qual já falamos anteriormente.</p>
<blockquote>
<p><strong>Reforçando:</strong> O motivo de não termos configurado um <em>NAT Gateway</em> é porque ele é <strong><em>pago</em></strong>. Ele possui um limite para uso gratuito, mas preferimos não correr o risco de ultrapassar esse limite e sermos cobrados. Por isso, não temos a conexão da nossa máquina com o mundo externo.</p>
</blockquote>
<p>Em um cenário real, na criação da VPC nós já definiríamos a utilização de um <em>NAT Gateway</em>. Contudo, é possível definir os <em>gateways</em> por meio do painel da VTC, localizado na página da AWS.</p>
<p>Nele encontramos links para vários serviços. Um deles é o “<em>Gateways NAT</em>”. Clicando nesta opção, poderíamos selecionar o botão "Criar <em>gateway</em> NAT" e criar um <em>gateway</em>, o qual posteriormente adicionaríamos a alguma sub-rede, adicionando-a no campo intitulado "Sub-rede".</p>
<p>Este processo é bastante simples: adicionaríamos um IP elástico ao nosso <em>NAT Gateway</em> enquanto a própria AWS faria todo o roteamento — portanto, não precisaríamos nos preocupar com isso.</p>
<p>Conforme abordado anteriormente, se adicionamos algum tipo de roteamento ou conexão entre a minha rede e um <em>Internet Gateway</em>, ela se torna pública. No próximo vídeo faremos este processo, tornando a nossa rede, antes privada, em uma rede pública.</p>
                        </div>